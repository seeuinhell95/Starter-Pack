#pragma semicolon 1

#include <sourcemod>
#include <sdktools>
#include <sdkhooks>

public Plugin myinfo =
{
	name = "[CSGO] Server Crash Exploit Fix",
	author = "BackWards | Edited: somebody.",
	description = "Server Crash Exploit Fix",
	version = "1.0",
	url = "http://sourcemod.net"
}

Address:addy = view_as<Address>(0);

public OnPluginStart()
{
	Address:addy = GameConfGetAddress(LoadGameConfigFile("CrashExploitFix"), "Unnamed");

	if(addy != view_as<Address>(0))
	{
		if (GetEngineVersion() == Engine_CSGO)
		{
			new OS = LoadFromAddress(addy + Address:1, NumberType_Int8);
			switch(OS)
			{
				case 0x89:
				{
					StoreToAddress(addy, 0xC3, NumberType_Int8);
				} 
				case 0x8B:
				{
					Address addy2 = addy + Address:162;
					for(int i = 0;i<6;i++)
						StoreToAddress(addy2 + Address:i, 0x90, NumberType_Int8);
				}
				default:
				{
					SetFailState("Unnamed Signature Incorrect. (0x%.2x)", OS);
				}
			}
		}
	}
	else
	{
		SetFailState("Unnamed Signature Incorrect (2).");
	}
}